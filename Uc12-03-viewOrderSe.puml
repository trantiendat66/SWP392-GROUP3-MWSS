@startuml
autonumber
autoactivate on
hide footbox

actor Customer
boundary "order-list.jsp" as JSP
control "OrderListServlet#doGet" as CTRL
entity "OrderDAO" as ODAO
control "DBContext" as DBC
database "Database" as DB

' --- Hiển thị danh sách lịch sử đơn hàng ---
Customer -> CTRL : 1. GET /orders?status&page&size
CTRL -> ODAO : 2. findByCustomer(customerId, status, page, size)
ODAO -> DBC : 2.1 open connection
DBC -> DB : 2.2 SELECT orders (filter status?) with paging
DB --> DBC : 2.3 List<Order>
DBC --> ODAO : 2.4 List<Order>
ODAO --> CTRL : 2.5 List<Order>

CTRL -> ODAO : 3. countByCustomer(customerId, status)
ODAO -> DBC : 3.1 open connection
DBC -> DB : 3.2 SELECT COUNT(*)
DB --> DBC : 3.3 total
DBC --> ODAO : 3.4 total
ODAO --> CTRL : 3.5 total

CTRL --> JSP : 4. Forward order-list.jsp (orders, paging, status)

' --- (Tuỳ chọn) Người dùng xem chi tiết một đơn ---
opt [View Order Details]
  Customer -> CTRL : 5. GET /orders/detail?orderId
  CTRL -> ODAO : 6. getDetails(orderId)
  ODAO -> DBC : 6.1 open connection
  DBC -> DB : 6.2 SELECT OrderDetail by orderId
  DB --> DBC : 6.3 List<OrderDetail>
  DBC --> ODAO : 6.4 List<OrderDetail>
  ODAO --> CTRL : 6.5 List<OrderDetail>
  CTRL --> JSP : 7. Forward order-detail.jsp (details)
end
@enduml
